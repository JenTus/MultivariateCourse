---
title: "Bivariate Correspondence Analysis"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Bivariate Correspondence Analysis

The data SMOKING1.txt contains a two-dimensional frequency table, where the
employees of a company have been categorized according to their position (5 cat-
egories: SM = Senior Managers, JM= Junior Managers, SE = Senior Employees,
JE = Junior Employees, SC = Secretaries). The smoking of the employees have
4 categories (None, Light, Medium, Heavy).

## Q1

Form the row and column profiles.

```{r}
smok <- read.table("data/SMOKING.txt", header = TRUE, row.names = 1)
smok <- smok[-dim(smok)[1], -dim(smok)[2]] #remove the total col/row
# View(smok)
D <- as.matrix(smok)
prop.table(D, 1) # row profiles
prop.table(D, 2) # col profiles

row.sum <- apply(smok, 1, sum)
row.profile <- sweep(smok, 1, row.sum, "/")

col.sum <- apply(smok, 2, sum)
col.profile <- sweep(smok, 2, col.sum, "/")
```

## chi-square test
```{r}
n <- sum(smok)
v1 <- matrix(colSums(smok), nrow = 1)
v2 <- matrix(rowSums(smok), ncol = 1)
E <- v2 %*% v1 / n # theoretical frequencies under independence
chi <- sum((D - E)^2 / E) # chi-square statistics
I <- dim(D)[1]
J <- dim(D)[2]
pchisq(chi, df = ((I-1)*(J-1)), lower.tail = F) # p-value

chisq.test(smok)

```

## Analysis ca

```{r}
library(ca)
n <- sum(smok)
smok.ca <- ca(smok)
names(smok.ca)
smok.ca$sv

smok.ca$rowdist # Row chi-square distances to centroid
smok.ca$rownames
smok.ca$coldist
smok.ca$colnames

smok.ca$rowcoord # caled coordinates
smok.ca$colcoord

smok.ca$rowcoord[1,]*smok.ca$sv*1000 # coordinates in the summary

sqrt(sum((smok.ca$rowcoord[1,]*smok.ca$sv)^2)) # distance from the center for SM

smok.ca$rowinertia 
smok.ca$colinertia 

#innertia is the chi squared statistic divided by n
sum(smok.ca$rowinertia)
sum(smok.ca$colinertia)
sum(smok.ca$sv^2)
chi/n

#take an example
sum((smok[1,] - E[1,])^2/E[1,])/n
smok.ca$rowinertia[1]

#proportional values, the same as in the summary
smok.ca$rowinertia/sum(smok.ca$sv^2) * 1000

# relative marginal frequencies of the original table
smok.ca$rowmass
rowSums(smok/n)
smok.ca$colmass
colSums(smok/n)

# the original table
smok.ca$N

# quality of representation??

# ctr, the contribution in forming that ca-component

names(summary(smok.ca)$rows)
```

## Q2

How much of the variation is explained by the combination of components 1
and 3. Give the answer in percentages relative to the total variation.

```{r}
library(ca)
smok.ca <- ca(smok)
summary(smok.ca)
```

## Q3

Produce the BCA graph with respect to the first two components.

```{r}
plot(smok.ca, arrows=c(TRUE, T))
```

## Q4

How much of the variation of the modality Heavy is explained by the first two
components? How much of the variation of the modality Medium is explained
by the first two components? Give the answers in percentages relative to the
total variation. Hint: use the quality of representation.

```{r}
n <- sum(smok)
ca.row <- smok.ca$rowcoord
f_row <- row.sum / n

ca.col <- smok.ca$colcoord
f_col <- col.sum / n 

#the modality Heavy explained by the first two components.
sum(ca.col["Heavy",c(1,2)]*ca.col["Heavy",c(1,2)])/sum(ca.col["Heavy",]*ca.col["Heavy",])

#the modality Medium explained by the first two components.
sum(ca.col["Medium",c(1,2)]*ca.col["Medium",c(1,2)])/sum(ca.col["Medium",]*ca.col["Medium",])
```


