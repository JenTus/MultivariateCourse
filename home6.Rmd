---
title: "Bivariate Correspondence Analysis"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Bivariate Correspondence Analysis

The data SMOKING1.txt contains a two-dimensional frequency table, where the
employees of a company have been categorized according to their position (5 cat-
egories: SM = Senior Managers, JM= Junior Managers, SE = Senior Employees,
JE = Junior Employees, SC = Secretaries). The smoking of the employees have
4 categories (None, Light, Medium, Heavy).

## Q1

Form the row and column profiles.

```{r}
smok <- read.table("data/SMOKING.txt", header = TRUE, row.names = 1)
smok <- smok[-dim(smok)[1], -dim(smok)[2]] #remove the total col/row
# View(smok)
D <- as.matrix(smok)
prop.table(D, 1) # row profiles
prop.table(D, 2) # col profiles

row.sum <- apply(smok, 1, sum)
row.profile <- sweep(smok, 1, row.sum, "/")

col.sum <- apply(smok, 2, sum)
col.profile <- sweep(smok, 2, col.sum, "/")
```

## chi-square test
```{r}
n <- sum(smok)
v1 <- matrix(colSums(smok), nrow = 1)
v2 <- matrix(rowSums(smok), ncol = 1)
E <- v2 %*% v1 / n # theoretical frequencies under independence
chi <- sum((D - E)^2 / E) # chi-square statistics
I <- dim(D)[1]
J <- dim(D)[2]
pchisq(chi, df = ((I-1)*(J-1)), lower.tail = F) # p-value

chisq.test(smok)

```

## Analysis ca

```{r}
library(ca)
n <- sum(smok)
smok.ca <- ca(smok)
names(smok.ca)
smok.ca$sv # sqrt(lambda_i)

smok.ca$rowdist # Row chi-square distances to centroid
smok.ca$rownames
smok.ca$coldist
smok.ca$colnames

smok.ca$rowcoord # scaled coordinates phi_ji/sqrt(lambda_i)
smok.ca$colcoord

smok.ca$rowcoord[1,]*smok.ca$sv*1000 # coordinates in the summary

sqrt(sum((smok.ca$rowcoord[1,]*smok.ca$sv)^2)) # distance from the center for SM

#innertia is the chi squared statistic divided by n
smok.ca$rowinertia 
smok.ca$colinertia 

sum(smok.ca$rowinertia)
sum(smok.ca$colinertia)
sum(smok.ca$sv^2)
chi/n

#take an example
sum((smok[1,] - E[1,])^2/E[1,])/n
smok.ca$rowinertia[1]

#proportional values, the same as in the summary
smok.ca$rowinertia/sum(smok.ca$sv^2) * 1000

# relative marginal frequencies of the original table
smok.ca$rowmass
rowSums(smok/n)
margin.table(as.matrix(smok), 1)/sum(smok)
smok.ca$colmass
colSums(smok/n)

# the original table
smok.ca$N

# ctr, the contribution in forming that ca-component, SM
margins <- smok.ca$rowmass
margins[1]*smok.ca$rowcoord[1,2]^2 # ctr

# quality of representation --- Squared correlation
# Squared correlation of SM, quality of representation
d1 = (smok.ca$rowcoord[1,]*smok.ca$sv)^2 # sum(phi_ij^2)
d1/sum(d1)
```

## Q2

How much of the variation is explained by the combination of components 1
and 3. Give the answer in percentages relative to the total variation.

```{r}
library(ca)
smok.ca <- ca(smok)
smok.ca$sv^2/sum(smok.ca$sv^2)
summary(smok.ca)
```

## Q3

Produce the BCA graph with respect to the first two components.

```{r}
library
plot(smok.ca, arrows=c(TRUE, T), map = "symmetric")
plot(smok.ca, arrows=c(TRUE, T), map = "symmetric", dim = c(1,3))
plot(smok.ca, arrows = c(T, T), map = "rowprincipal")
```

## Q4

How much of the variation of the modality Heavy is explained by the first two
components? How much of the variation of the modality Medium is explained
by the first two components? Give the answers in percentages relative to the
total variation. Hint: use the quality of representation.

```{r}
# the variation of the modality Heavy explained by the first two components
h <- (smok.ca$colcoord[4,]*smok.ca$sv)^2
sum(h[c(1,2)])/sum(h)

# the variation of the modality Medium explained by the first two components
m <- (smok.ca$colcoord[3,]*smok.ca$sv)^2
sum(m[c(1,2)])/sum(m)
```


